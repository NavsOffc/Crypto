<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CryptoDAX - Platform Jual Beli Kripto Indonesia</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Semua kode CSS dari file sebelumnya */
        :root {
            --primary: #1e3a8a;
            --primary-light: #3b82f6;
            --secondary: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #1f2937;
            --light: #f8fafc;
            --gray: #6b7280;
            --border: #e5e7eb;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --transition: all 0.3s ease;
        }

        [data-theme="dark"] {
            --primary: #1e40af;
            --primary-light: #60a5fa;
            --light: #111827;
            --dark: #f9fafb;
            --gray: #9ca3af;
            --border: #374151;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--light);
            color: var(--dark);
            line-height: 1.6;
            transition: var(--transition);
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header Styles */
        header {
            background-color: var(--primary);
            color: white;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
            transition: var(--transition);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .logo i {
            font-size: 1.8rem;
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 25px;
        }

        nav a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            padding: 5px 10px;
            border-radius: 5px;
            position: relative;
            overflow: hidden;
        }

        nav a:hover, nav a.active {
            background-color: rgba(255, 255, 255, 0.1);
        }

        nav a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background-color: white;
            transition: width 0.3s ease;
        }

        nav a:hover::after, nav a.active::after {
            width: 100%;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .theme-toggle {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.2rem;
            transition: var(--transition);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-toggle:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .btn {
            padding: 8px 16px;
            border-radius: 5px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            font-family: 'Poppins', sans-serif;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background-color: var(--primary-light);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid blue;
            color: blue;
        }

        .btn-outline:hover {
            background-color: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .btn-success {
            background-color: var(--secondary);
            color: white;
        }

        .btn-success:hover {
            background-color: #0da271;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(16, 185, 129, 0.3);
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background-color: #dc2626;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(239, 68, 68, 0.3);
        }

        /* Main Content */
        .main-content {
            min-height: calc(100vh - 140px);
            padding: 30px 0;
            opacity: 1;
            transition: opacity 0.3s ease;
        }

        .page {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .page.active {
            display: block;
        }

        .page-title {
            margin-bottom: 20px;
            font-size: 1.8rem;
            color: var(--primary);
            position: relative;
            display: inline-block;
        }

        .page-title::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 50px;
            height: 3px;
            background-color: var(--primary);
            border-radius: 2px;
        }

        /* Home Page */
        .crypto-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .crypto-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid var(--border);
            animation: cardSlideIn 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        @keyframes cardSlideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .crypto-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .crypto-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .crypto-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #f3f4f6;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
            font-size: 1.2rem;
            transition: var(--transition);
        }

        .crypto-card:hover .crypto-icon {
            transform: scale(1.1);
        }

        .crypto-name {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .crypto-symbol {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .crypto-price {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .crypto-change {
            display: flex;
            align-items: center;
            font-weight: 500;
        }

        .positive {
            color: var(--secondary);
        }

        .negative {
            color: var(--danger);
        }

        /* Table Styles */
        .table-container {
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            animation: fadeIn 0.5s ease;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--border);
            transition: var(--transition);
        }

        th {
            background-color: #f9fafb;
            font-weight: 600;
            color: var(--gray);
        }

        tr {
            transition: var(--transition);
        }

        tr:hover {
            background-color: #f9fafb;
            transform: scale(1.01);
        }

        /* Auth Pages */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 70vh;
        }

        .auth-box {
            background-color: white;
            border-radius: 10px;
            padding: 30px;
            width: 100%;
            max-width: 400px;
            box-shadow: var(--shadow);
            animation: cardSlideIn 0.5s ease;
        }

        .auth-title {
            text-align: center;
            margin-bottom: 25px;
            color: var(--primary);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border);
            border-radius: 5px;
            font-family: 'Poppins', sans-serif;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            transform: translateY(-2px);
        }

        .auth-link {
            text-align: center;
            margin-top: 20px;
        }

        .auth-link a {
            color: var(--primary-light);
            text-decoration: none;
            transition: var(--transition);
        }

        .auth-link a:hover {
            text-decoration: underline;
            color: var(--primary);
        }

        /* Dashboard */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .dashboard-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            animation: cardSlideIn 0.5s ease;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .card-title {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 10px;
        }

        .card-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
        }

        .profit-card {
            border-left: 4px solid var(--secondary);
        }

        .loss-card {
            border-left: 4px solid var(--danger);
        }

        .chart-container {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            height: 400px;
            animation: fadeIn 0.5s ease;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }

        /* Wallet Page */
        .wallet-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .wallet-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: var(--shadow);
            animation: cardSlideIn 0.5s ease;
        }

        .wallet-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .wallet-actions {
            display: flex;
            gap: 10px;
        }

        /* Payment Gateway Styles */
        .payment-methods {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .payment-method {
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .payment-method:hover {
            border-color: var(--primary-light);
            transform: translateY(-3px);
        }

        .payment-method.selected {
            border-color: var(--primary);
            background-color: rgba(59, 130, 246, 0.05);
            transform: scale(1.05);
        }

        .payment-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .payment-name {
            font-weight: 500;
        }

        .payment-fee {
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 5px;
        }

        .verification-step {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 8px;
            background-color: #f8fafc;
            border-left: 4px solid var(--primary);
            animation: fadeIn 0.5s ease;
        }

        .step-title {
            font-weight: 600;
            margin-bottom: 10px;
        }

        .step-description {
            font-size: 0.9rem;
            color: var(--gray);
        }

        .withdrawal-info {
            background-color: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            animation: fadeIn 0.5s ease;
        }

        .withdrawal-info h4 {
            color: #d97706;
            margin-bottom: 10px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: white;
            border-radius: 10px;
            width: 100%;
            max-width: 500px;
            padding: 30px;
            box-shadow: var(--shadow);
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-20px) scale(0.9); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.5rem;
            color: var(--primary);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
            transition: var(--transition);
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close-modal:hover {
            background-color: #f3f4f6;
            color: var(--dark);
        }

        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            box-shadow: var(--shadow);
            z-index: 1100;
            animation: slideInRight 0.3s ease, slideOutRight 0.3s ease 2.7s forwards;
            max-width: 350px;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        .notification.success {
            background-color: var(--secondary);
        }

        .notification.error {
            background-color: var(--danger);
        }

        .notification.warning {
            background-color: var(--warning);
        }

        /* Withdraw Limits */
        .withdraw-limits {
            background-color: #f0f9ff;
            border: 1px solid var(--primary-light);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .withdraw-limits h4 {
            color: var(--primary);
            margin-bottom: 10px;
        }

        .limit-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        /* Footer */
        footer {
            background-color: var(--primary);
            color: white;
            padding: 30px 0;
            text-align: center;
            transition: var(--transition);
        }

        /* Additional styles for percentage buttons */
        .percentage-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .percentage-btn {
            flex: 1;
            padding: 8px 5px;
            background-color: #f3f4f6;
            border: 1px solid var(--border);
            border-radius: 5px;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            font-weight: 500;
        }
        
        .percentage-btn:hover {
            background-color: var(--primary-light);
            color: white;
        }
        
        .percentage-btn.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Responsive Styles */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }

            nav ul {
                gap: 15px;
            }

            .crypto-grid {
                grid-template-columns: 1fr;
            }

            .dashboard-cards, .wallet-cards {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
            }

            .payment-methods {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-coins"></i>
                    <span>CryptoDAX</span>
                </div>
                <nav>
                    <ul>
                        <li><a href="#" class="nav-link active" data-page="home">Beranda</a></li>
                        <li><a href="#" class="nav-link" data-page="market">Market</a></li>
                        <li><a href="#" class="nav-link" data-page="wallet">Wallet</a></li>
                        <li><a href="#" class="nav-link" data-page="profile">Profil</a></li>
                    </ul>
                </nav>
                <div class="header-actions">
                    <button class="theme-toggle" id="themeToggle">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button class="btn btn-outline" id="loginBtn">Login</button>
                    <button class="btn btn-primary" id="registerBtn">Daftar</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="main-content">
        <div class="container">
            <!-- Home Page -->
            <div id="home" class="page active">
                <h1 class="page-title">Harga Kripto Terkini</h1>
                
                <div class="crypto-grid" id="cryptoGrid">
                    <!-- Crypto cards will be generated by JavaScript -->
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Aset</th>
                                <th>Harga</th>
                                <th>24h</th>
                                <th>Volume</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="cryptoTable">
                            <!-- Table rows will be generated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Market Page -->
            <div id="market" class="page">
                <h1 class="page-title">Market Kripto</h1>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Aset</th>
                                <th>Harga</th>
                                <th>24h</th>
                                <th>7d</th>
                                <th>Volume</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="marketTable">
                            <!-- Market table rows will be generated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Wallet Page -->
            <div id="wallet" class="page">
                <h1 class="page-title">Wallet & Saldo</h1>
                
                <div class="wallet-cards">
                    <div class="wallet-card">
                        <div class="wallet-header">
                            <div>
                                <div class="card-title">Saldo Rupiah</div>
                                <div class="card-value" id="idrBalance">Rp 0</div>
                            </div>
                            <div class="wallet-actions">
                                <button class="btn btn-primary" id="depositBtn">Deposit</button>
                                <button class="btn btn-outline" id="withdrawBtn">Withdraw</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <h2 style="margin: 30px 0 15px;">Aset Kripto Saya</h2>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Aset</th>
                                <th>Jumlah</th>
                                <th>Nilai (IDR)</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="walletAssets">
                            <!-- Wallet assets will be generated by JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <h2 style="margin: 30px 0 15px;">Riwayat Transaksi</h2>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Tanggal</th>
                                <th>Tipe</th>
                                <th>Jumlah</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="transactionHistory">
                            <!-- Transaction history will be generated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Profile Page -->
            <div id="profile" class="page">
                <h1 class="page-title">Profil Pengguna</h1>
                <div class="dashboard-cards">
                    <div class="dashboard-card">
                        <div class="card-title">Total Investasi</div>
                        <div class="card-value" id="totalInvestment">Rp 0</div>
                    </div>
                    <div class="dashboard-card profit-card">
                        <div class="card-title">Total Profit</div>
                        <div class="card-value positive" id="totalProfit">Rp 0</div>
                    </div>
                    <div class="dashboard-card loss-card">
                        <div class="card-title">Total Loss</div>
                        <div class="card-value negative" id="totalLoss">Rp 0</div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-title">Aset Tersimpan</div>
                        <div class="card-value" id="totalAssets">0</div>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" id="editProfileBtn">Edit Profil</button>
                    <button class="btn btn-danger" id="logoutBtn">Logout</button>
                </div>
            </div>

            <!-- Login Page -->
            <div id="login" class="page">
                <div class="auth-container">
                    <div class="auth-box">
                        <h2 class="auth-title">Login ke CryptoDAX</h2>
                        <form id="loginForm">
                            <div class="form-group">
                                <label for="loginEmail">Email</label>
                                <input type="email" id="loginEmail" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="loginPassword">Password</label>
                                <input type="password" id="loginPassword" class="form-control" required>
                            </div>
                            <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
                        </form>
                        <div class="auth-link">
                            <p>Belum punya akun? <a href="#" id="showRegister">Daftar di sini</a></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Register Page -->
            <div id="register" class="page">
                <div class="auth-container">
                    <div class="auth-box">
                        <h2 class="auth-title">Daftar Akun CryptoDAX</h2>
                        <form id="registerForm">
                            <div class="form-group">
                                <label for="registerName">Nama Lengkap</label>
                                <input type="text" id="registerName" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="registerEmail">Email</label>
                                <input type="email" id="registerEmail" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="registerPassword">Password</label>
                                <input type="password" id="registerPassword" class="form-control" required minlength="6">
                            </div>
                            <div class="form-group">
                                <label for="registerConfirmPassword">Konfirmasi Password</label>
                                <input type="password" id="registerConfirmPassword" class="form-control" required>
                            </div>
                            <button type="submit" class="btn btn-primary" style="width: 100%;">Daftar</button>
                        </form>
                        <div class="auth-link">
                            <p>Sudah punya akun? <a href="#" id="showLogin">Login di sini</a></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard Page -->
            <div id="dashboard" class="page">
                <h1 class="page-title">Dashboard</h1>
                
                <div class="dashboard-cards">
                    <div class="dashboard-card">
                        <div class="card-title">Saldo Rupiah</div>
                        <div class="card-value" id="dashboardBalance">Rp 0</div>
                    </div>
                    <div class="dashboard-card">
                        <div class="card-title">Total Aset</div>
                        <div class="card-value" id="dashboardAssets">Rp 0</div>
                    </div>
                    <div class="dashboard-card profit-card">
                        <div class="card-title">Total Profit Selama Investasi</div>
                        <div class="card-value positive" id="dashboardProfit">Rp 0</div>
                    </div>
                    <div class="dashboard-card loss-card">
                        <div class="card-title">Total Loss Selama Investasi</div>
                        <div class="card-value negative" id="dashboardLoss">Rp 0</div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="priceChart"></canvas>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-success" id="buyCryptoBtn">Beli Kripto</button>
                    <button class="btn btn-danger" id="sellCryptoBtn">Jual Kripto</button>
                </div>
                
                <h2 style="margin: 30px 0 15px;">Portofolio Saya</h2>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Aset</th>
                                <th>Jumlah</th>
                                <th>Harga Beli</th>
                                <th>Nilai Saat Ini</th>
                                <th>Profit/Loss</th>
                            </tr>
                        </thead>
                        <tbody id="portfolioTable">
                            <!-- Portfolio table will be generated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Deposit Modal -->
    <div class="modal" id="depositModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Deposit Rupiah</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="verification-step">
                <div class="step-title">Verifikasi Akun</div>
                <div class="step-description">Untuk melakukan deposit, Anda perlu melengkapi verifikasi akun terlebih dahulu.</div>
            </div>
            <form id="depositForm">
                <div class="form-group">
                    <label for="depositAmount">Jumlah Deposit (Min. Rp 10.000)</label>
                    <input type="number" id="depositAmount" class="form-control" min="10000" required>
                </div>
                
                <div class="form-group">
                    <label>Pilih Metode Pembayaran</label>
                    <div class="payment-methods">
                        <div class="payment-method" data-method="bank_transfer">
                            <div class="payment-icon">🏦</div>
                            <div class="payment-name">Transfer Bank</div>
                            <div class="payment-fee">Biaya: Rp 2.500</div>
                        </div>
                        <div class="payment-method" data-method="virtual_account">
                            <div class="payment-icon">💳</div>
                            <div class="payment-name">Virtual Account</div>
                            <div class="payment-fee">Biaya: Rp 3.000</div>
                        </div>
                        <div class="payment-method" data-method="ewallet">
                            <div class="payment-icon">📱</div>
                            <div class="payment-name">E-Wallet</div>
                            <div class="payment-fee">Biaya: Rp 1.500</div>
                        </div>
                        <div class="payment-method" data-method="qris">
                            <div class="payment-icon">📲</div>
                            <div class="payment-name">QRIS</div>
                            <div class="payment-fee">Biaya: Rp 1.000</div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="depositNotes">Catatan (Opsional)</label>
                    <textarea id="depositNotes" class="form-control" rows="2" placeholder="Tambahkan catatan untuk transaksi ini"></textarea>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%;">Lanjutkan ke Pembayaran</button>
            </form>
        </div>
    </div>

    <!-- Withdraw Modal -->
    <div class="modal" id="withdrawModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Withdraw Rupiah</h3>
                <button class="close-modal">&times;</button>
            </div>
            
            <div class="withdrawal-info">
                <h4>Informasi Penting</h4>
                <p>Proses penarikan dana memerlukan waktu 1-3 hari kerja. Pastikan data rekening tujuan sudah benar.</p>
            </div>
            
            <div class="withdraw-limits">
                <h4>Batas Penarikan</h4>
                <div class="limit-item">
                    <span>Minimum Penarikan:</span>
                    <span>Rp 50.000</span>
                </div>
                <div class="limit-item">
                    <span>Maksimum Harian:</span>
                    <span>Rp 100.000.000</span>
                </div>
                <div class="limit-item">
                    <span>Biaya Admin:</span>
                    <span>Rp 6.500</span>
                </div>
            </div>
            
            <form id="withdrawForm">
                <div class="form-group">
                    <label for="withdrawAmount">Jumlah Withdraw</label>
                    <input type="number" id="withdrawAmount" class="form-control" min="50000" max="100000000" required>
                    <small style="color: var(--gray); margin-top: 5px; display: block;">Saldo tersedia: <span id="availableBalance">Rp 0</span></small>
                </div>
                
                <div class="form-group">
                    <label for="withdrawBank">Bank Tujuan</label>
                    <select id="withdrawBank" class="form-control" required>
                        <option value="">Pilih Bank</option>
                        <option value="bca">BCA</option>
                        <option value="bni">BNI</option>
                        <option value="bri">BRI</option>
                        <option value="mandiri">Mandiri</option>
                        <option value="cimb">CIMB Niaga</option>
                        <option value="other">Bank Lainnya</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="withdrawAccountNumber">Nomor Rekening</label>
                    <input type="text" id="withdrawAccountNumber" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="withdrawAccountName">Nama Pemilik Rekening</label>
                    <input type="text" id="withdrawAccountName" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="withdrawNotes">Catatan (Opsional)</label>
                    <textarea id="withdrawNotes" class="form-control" rows="2" placeholder="Tambahkan catatan untuk transaksi ini"></textarea>
                </div>
                
                <div class="withdrawal-summary" style="background-color: #f0f9ff; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <h4 style="color: var(--primary); margin-bottom: 10px;">Ringkasan Withdraw</h4>
                    <div class="limit-item">
                        <span>Jumlah Withdraw:</span>
                        <span id="summaryAmount">Rp 0</span>
                    </div>
                    <div class="limit-item">
                        <span>Biaya Admin:</span>
                        <span>Rp 6.500</span>
                    </div>
                    <div class="limit-item" style="font-weight: 600; border-top: 1px solid var(--border); padding-top: 5px;">
                        <span>Total yang akan ditarik:</span>
                        <span id="summaryTotal">Rp 0</span>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%;" id="submitWithdrawBtn">Ajukan Withdraw</button>
            </form>
        </div>
    </div>

    <!-- Withdraw Confirmation Modal -->
    <div class="modal" id="withdrawConfirmModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Konfirmasi Withdraw</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div style="text-align: center; margin-bottom: 20px;">
                <i class="fas fa-exclamation-circle" style="font-size: 3rem; color: var(--warning); margin-bottom: 15px;"></i>
                <h4 style="margin-bottom: 10px;">Apakah Anda yakin ingin melakukan withdraw?</h4>
                <p style="color: var(--gray);">Pastikan data rekening tujuan sudah benar. Transaksi tidak dapat dibatalkan setelah diproses.</p>
            </div>
            
            <div style="background-color: #f8fafc; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <div class="limit-item">
                    <span>Jumlah Withdraw:</span>
                    <span id="confirmAmount">Rp 0</span>
                </div>
                <div class="limit-item">
                    <span>Biaya Admin:</span>
                    <span>Rp 6.500</span>
                </div>
                <div class="limit-item">
                    <span>Bank Tujuan:</span>
                    <span id="confirmBank">-</span>
                </div>
                <div class="limit-item">
                    <span>No. Rekening:</span>
                    <span id="confirmAccountNumber">-</span>
                </div>
                <div class="limit-item">
                    <span>Nama Penerima:</span>
                    <span id="confirmAccountName">-</span>
                </div>
                <div class="limit-item" style="font-weight: 600; border-top: 1px solid var(--border); padding-top: 5px;">
                    <span>Total yang akan ditarik:</span>
                    <span id="confirmTotal">Rp 0</span>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-outline" style="flex: 1;" id="cancelWithdrawBtn">Batal</button>
                <button class="btn btn-primary" style="flex: 1;" id="confirmWithdrawBtn">Konfirmasi</button>
            </div>
        </div>
    </div>

    <!-- Payment Processing Modal -->
    <div class="modal" id="paymentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="paymentModalTitle">Proses Pembayaran</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div id="paymentContent">
                <!-- Payment content will be generated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Verification Modal -->
    <div class="modal" id="verificationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Verifikasi Akun</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="verification-step">
                <div class="step-title">Langkah 1: Verifikasi Email</div>
                <div class="step-description">Kami telah mengirimkan kode verifikasi ke email Anda. Masukkan kode tersebut di bawah ini.</div>
            </div>
            <form id="emailVerificationForm">
                <div class="form-group">
                    <label for="emailCode">Kode Verifikasi Email</label>
                    <input type="text" id="emailCode" class="form-control" maxlength="6" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Verifikasi Email</button>
            </form>
            
            <div class="verification-step" style="margin-top: 20px;">
                <div class="step-title">Langkah 2: Verifikasi Identitas</div>
                <div class="step-description">Unggah foto KTP dan selfie dengan KTP untuk menyelesaikan verifikasi.</div>
            </div>
            <form id="identityVerificationForm">
                <div class="form-group">
                    <label for="ktpPhoto">Foto KTP</label>
                    <input type="file" id="ktpPhoto" class="form-control" accept="image/*" required>
                </div>
                <div class="form-group">
                    <label for="selfiePhoto">Selfie dengan KTP</label>
                    <input type="file" id="selfiePhoto" class="form-control" accept="image/*" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Verifikasi Identitas</button>
            </form>
        </div>
    </div>

    <!-- Buy Crypto Modal (Updated with percentage buttons) -->
    <div class="modal" id="buyCryptoModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Beli Kripto</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="buyCryptoForm">
                <div class="form-group">
                    <label for="buyCryptoSelect">Pilih Kripto</label>
                    <select id="buyCryptoSelect" class="form-control" required>
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="buyAmount">Jumlah (IDR)</label>
                    <input type="number" id="buyAmount" class="form-control" min="10000" required>
                    <div class="percentage-buttons">
                        <button type="button" class="percentage-btn" data-percentage="25">25%</button>
                        <button type="button" class="percentage-btn" data-percentage="50">50%</button>
                        <button type="button" class="percentage-btn" data-percentage="75">75%</button>
                        <button type="button" class="percentage-btn" data-percentage="100">100%</button>
                    </div>
                    <small style="color: var(--gray); margin-top: 5px; display: block;">
                        Saldo tersedia: <span id="availableBuyBalance">Rp 0</span>
                    </small>
                </div>
                <button type="submit" class="btn btn-success" style="width: 100%;">Beli</button>
            </form>
        </div>
    </div>

    <!-- Sell Crypto Modal (Updated with percentage buttons) -->
    <div class="modal" id="sellCryptoModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Jual Kripto</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="sellCryptoForm">
                <div class="form-group">
                    <label for="sellCryptoSelect">Pilih Kripto</label>
                    <select id="sellCryptoSelect" class="form-control" required>
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="sellAmount">Jumlah</label>
                    <input type="number" id="sellAmount" class="form-control" min="0.0001" step="0.0001" required>
                    <div class="percentage-buttons">
                        <button type="button" class="percentage-btn" data-percentage="25">25%</button>
                        <button type="button" class="percentage-btn" data-percentage="50">50%</button>
                        <button type="button" class="percentage-btn" data-percentage="75">75%</button>
                        <button type="button" class="percentage-btn" data-percentage="100">100%</button>
                    </div>
                    <small style="color: var(--gray); margin-top: 5px; display: block;">
                        Jumlah tersedia: <span id="availableSellAmount">0</span> <span id="sellCryptoUnit"></span>
                    </small>
                </div>
                <button type="submit" class="btn btn-danger" style="width: 100%;">Jual</button>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <p>&copy; 2023 CryptoDAX. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // Application State
        const appState = {
            currentUser: null,
            cryptoData: [],
            userData: {
                balance: 0,
                assets: {},
                transactions: [],
                verification: {
                    emailVerified: false,
                    identityVerified: false
                },
                bankAccounts: [],
                profit: 0,
                loss: 0
            },
            theme: 'light',
            priceHistory: {} // Store price history for charts
        };

        // Crypto Data (dummy data with initial values)
        const initialCryptoData = [
            { symbol: 'BTC', name: 'Bitcoin', price: 520000000, change24h: 2.5, volume: 1250000000000, icon: '₿' },
            { symbol: 'ETH', name: 'Ethereum', price: 28000000, change24h: -1.2, volume: 580000000000, icon: 'Ξ' },
            { symbol: 'DOGE', name: 'Dogecoin', price: 1200, change24h: 5.8, volume: 12000000000, icon: 'Ð' },
            { symbol: 'USDT', name: 'Tether', price: 15600, change24h: 0.1, volume: 4500000000000, icon: '₮' },
            { symbol: 'SOL', name: 'Solana', price: 1200000, change24h: 3.4, volume: 35000000000, icon: 'S' },
            { symbol: 'XRP', name: 'Ripple', price: 8500, change24h: -0.8, volume: 28000000000, icon: 'X' }
        ];

        // Initialize price history
        function initializePriceHistory() {
            appState.cryptoData.forEach(crypto => {
                appState.priceHistory[crypto.symbol] = [];
                
                // Generate initial price history (24 data points)
                let currentPrice = crypto.price;
                for (let i = 0; i < 24; i++) {
                    // Simulate realistic price movements
                    const change = (Math.random() * 4 - 2) / 100; // -2% to +2%
                    currentPrice = Math.max(1, currentPrice * (1 + change));
                    appState.priceHistory[crypto.symbol].push({
                        time: `${i}:00`,
                        price: currentPrice
                    });
                }
            });
        }

        // Payment Methods
        const paymentMethods = {
            bank_transfer: {
                name: 'Transfer Bank',
                fee: 2500,
                instructions: [
                    'Pilih bank tujuan: BCA, BNI, BRI, atau Mandiri',
                    'Transfer sesuai dengan jumlah yang tertera',
                    'Masukkan kode unik pada nominal transfer',
                    'Transaksi akan diproses otomatis dalam 5-10 menit'
                ]
            },
            virtual_account: {
                name: 'Virtual Account',
                fee: 3000,
                instructions: [
                    'Pilih bank Anda untuk pembayaran',
                    'Bayar melalui ATM, mobile banking, atau internet banking',
                    'Gunakan nomor virtual account yang diberikan',
                    'Transaksi akan diproses otomatis setelah pembayaran'
                ]
            },
            ewallet: {
                name: 'E-Wallet',
                fee: 1500,
                instructions: [
                    'Pilih e-wallet: OVO, Gopay, Dana, atau LinkAja',
                    'Scan QR code atau masukkan nomor tujuan',
                    'Konfirmasi pembayaran di aplikasi e-wallet Anda',
                    'Transaksi akan diproses dalam 1-3 menit'
                ]
            },
            qris: {
                name: 'QRIS',
                fee: 1000,
                instructions: [
                    'Buka aplikasi e-wallet atau mobile banking Anda',
                    'Scan QR code yang ditampilkan',
                    'Konfirmasi pembayaran',
                    'Transaksi akan diproses dalam 1-3 menit'
                ]
            }
        };

        // DOM Elements
        const pages = document.querySelectorAll('.page');
        const navLinks = document.querySelectorAll('.nav-link');
        const themeToggle = document.getElementById('themeToggle');
        const loginBtn = document.getElementById('loginBtn');
        const registerBtn = document.getElementById('registerBtn');
        const showLogin = document.getElementById('showLogin');
        const showRegister = document.getElementById('showRegister');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const logoutBtn = document.getElementById('logoutBtn');
        const depositBtn = document.getElementById('depositBtn');
        const withdrawBtn = document.getElementById('withdrawBtn');
        const depositModal = document.getElementById('depositModal');
        const withdrawModal = document.getElementById('withdrawModal');
        const withdrawConfirmModal = document.getElementById('withdrawConfirmModal');
        const paymentModal = document.getElementById('paymentModal');
        const verificationModal = document.getElementById('verificationModal');
        const depositForm = document.getElementById('depositForm');
        const withdrawForm = document.getElementById('withdrawForm');
        const emailVerificationForm = document.getElementById('emailVerificationForm');
        const identityVerificationForm = document.getElementById('identityVerificationForm');
        const buyCryptoBtn = document.getElementById('buyCryptoBtn');
        const sellCryptoBtn = document.getElementById('sellCryptoBtn');
        const buyCryptoModal = document.getElementById('buyCryptoModal');
        const sellCryptoModal = document.getElementById('sellCryptoModal');
        const buyCryptoForm = document.getElementById('buyCryptoForm');
        const sellCryptoForm = document.getElementById('sellCryptoForm');
        const closeModals = document.querySelectorAll('.close-modal');
        const cryptoGrid = document.getElementById('cryptoGrid');
        const cryptoTable = document.getElementById('cryptoTable');
        const marketTable = document.getElementById('marketTable');
        const walletAssets = document.getElementById('walletAssets');
        const transactionHistory = document.getElementById('transactionHistory');
        const idrBalance = document.getElementById('idrBalance');
        const dashboardBalance = document.getElementById('dashboardBalance');
        const dashboardAssets = document.getElementById('dashboardAssets');
        const dashboardProfit = document.getElementById('dashboardProfit');
        const dashboardLoss = document.getElementById('dashboardLoss');
        const portfolioTable = document.getElementById('portfolioTable');
        const buyCryptoSelect = document.getElementById('buyCryptoSelect');
        const sellCryptoSelect = document.getElementById('sellCryptoSelect');
        const priceChartCanvas = document.getElementById('priceChart');
        const paymentMethodsElements = document.querySelectorAll('.payment-method');
        const paymentContent = document.getElementById('paymentContent');
        const paymentModalTitle = document.getElementById('paymentModalTitle');
        const availableBalance = document.getElementById('availableBalance');
        const withdrawAmount = document.getElementById('withdrawAmount');
        const summaryAmount = document.getElementById('summaryAmount');
        const summaryTotal = document.getElementById('summaryTotal');
        const submitWithdrawBtn = document.getElementById('submitWithdrawBtn');
        const confirmAmount = document.getElementById('confirmAmount');
        const confirmBank = document.getElementById('confirmBank');
        const confirmAccountNumber = document.getElementById('confirmAccountNumber');
        const confirmAccountName = document.getElementById('confirmAccountName');
        const confirmTotal = document.getElementById('confirmTotal');
        const cancelWithdrawBtn = document.getElementById('cancelWithdrawBtn');
        const confirmWithdrawBtn = document.getElementById('confirmWithdrawBtn');
        const totalProfit = document.getElementById('totalProfit');
        const totalLoss = document.getElementById('totalLoss');

        // Additional DOM elements for new features
        const availableBuyBalance = document.getElementById('availableBuyBalance');
        const availableSellAmount = document.getElementById('availableSellAmount');
        const sellCryptoUnit = document.getElementById('sellCryptoUnit');
        const percentageButtons = document.querySelectorAll('.percentage-btn');

        // Initialize Application
        function initApp() {
            // Load theme from localStorage
            const savedTheme = localStorage.getItem('cryptodax-theme');
            if (savedTheme) {
                appState.theme = savedTheme;
                document.body.setAttribute('data-theme', appState.theme);
                updateThemeToggleIcon();
            }

            // Load user data from localStorage
            const savedUser = localStorage.getItem('cryptodax-user');
            if (savedUser) {
                appState.currentUser = JSON.parse(savedUser);
                loadUserData();
                showDashboard();
            } else {
                showHomePage();
            }

            // Initialize crypto data
            appState.cryptoData = [...initialCryptoData];
            
            // Initialize price history
            initializePriceHistory();
            
            updateCryptoDisplay();

            // Set up event listeners
            setupEventListeners();

            // Start price updates
            startPriceUpdates();

            // Initialize chart
            initChart();
        }

        // Set up event listeners
        function setupEventListeners() {
            // Navigation
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = e.target.getAttribute('data-page');
                    showPage(page);
                    
                    // Update active nav link
                    navLinks.forEach(nav => nav.classList.remove('active'));
                    e.target.classList.add('active');
                });
            });

            // Auth buttons
            loginBtn.addEventListener('click', () => showPage('login'));
            registerBtn.addEventListener('click', () => showPage('register'));
            showLogin.addEventListener('click', (e) => {
                e.preventDefault();
                showPage('login');
            });
            showRegister.addEventListener('click', (e) => {
                e.preventDefault();
                showPage('register');
            });

            // Auth forms
            loginForm.addEventListener('submit', handleLogin);
            registerForm.addEventListener('submit', handleRegister);
            logoutBtn.addEventListener('click', handleLogout);

            // Wallet actions
            depositBtn.addEventListener('click', () => {
                if (!appState.currentUser) {
                    showPage('login');
                    return;
                }
                
                if (!appState.userData.verification.emailVerified || !appState.userData.verification.identityVerified) {
                    showModal(verificationModal);
                } else {
                    showModal(depositModal);
                }
            });
            
            withdrawBtn.addEventListener('click', () => {
                if (!appState.currentUser) {
                    showPage('login');
                    return;
                }
                
                if (!appState.userData.verification.emailVerified || !appState.userData.verification.identityVerified) {
                    showModal(verificationModal);
                } else {
                    showModal(withdrawModal);
                    updateWithdrawForm();
                }
            });
            
            depositForm.addEventListener('submit', handleDeposit);
            withdrawForm.addEventListener('submit', handleWithdraw);
            
            // Withdraw amount change
            withdrawAmount.addEventListener('input', updateWithdrawSummary);
            
            // Withdraw confirmation
            cancelWithdrawBtn.addEventListener('click', () => {
                withdrawConfirmModal.classList.remove('active');
            });
            
            confirmWithdrawBtn.addEventListener('click', processWithdraw);
            
            // Payment method selection
            paymentMethodsElements.forEach(method => {
                method.addEventListener('click', () => {
                    paymentMethodsElements.forEach(m => m.classList.remove('selected'));
                    method.classList.add('selected');
                });
            });
            
            // Verification forms
            emailVerificationForm.addEventListener('submit', handleEmailVerification);
            identityVerificationForm.addEventListener('submit', handleIdentityVerification);

            // Trade actions
            buyCryptoBtn.addEventListener('click', () => {
                populateCryptoSelect(buyCryptoSelect);
                showModal(buyCryptoModal);
            });
            sellCryptoBtn.addEventListener('click', () => {
                populateCryptoSelect(sellCryptoSelect, true);
                showModal(sellCryptoModal);
            });
            buyCryptoForm.addEventListener('submit', handleBuyCrypto);
            sellCryptoForm.addEventListener('submit', handleSellCrypto);

            // Percentage buttons for buy modal
            document.querySelectorAll('#buyCryptoModal .percentage-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    const percentage = parseInt(e.target.getAttribute('data-percentage'));
                    setBuyAmountByPercentage(percentage);
                    
                    // Update active state
                    document.querySelectorAll('#buyCryptoModal .percentage-btn').forEach(b => {
                        b.classList.remove('active');
                    });
                    e.target.classList.add('active');
                });
            });
            
            // Percentage buttons for sell modal
            document.querySelectorAll('#sellCryptoModal .percentage-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    const percentage = parseInt(e.target.getAttribute('data-percentage'));
                    setSellAmountByPercentage(percentage);
                    
                    // Update active state
                    document.querySelectorAll('#sellCryptoModal .percentage-btn').forEach(b => {
                        b.classList.remove('active');
                    });
                    e.target.classList.add('active');
                });
            });
            
            // Update available balance when crypto selection changes in buy modal
            buyCryptoSelect.addEventListener('change', updateAvailableBuyBalance);
            
            // Update available amount when crypto selection changes in sell modal
            sellCryptoSelect.addEventListener('change', updateAvailableSellAmount);

            // Theme toggle
            themeToggle.addEventListener('click', toggleTheme);

            // Close modals
            closeModals.forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.modal').forEach(modal => {
                        modal.classList.remove('active');
                    });
                });
            });

            // Close modal when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal')) {
                    e.target.classList.remove('active');
                }
            });
        }

        // Page Navigation
        function showPage(pageId) {
            // Add fade out animation
            const mainContent = document.querySelector('.main-content');
            mainContent.style.opacity = '0';
            
            setTimeout(() => {
                pages.forEach(page => {
                    page.classList.remove('active');
                });
                document.getElementById(pageId).classList.add('active');
                
                // Fade in
                mainContent.style.opacity = '1';
            }, 300);
        }

        function showHomePage() {
            showPage('home');
            updateHeaderForGuest();
        }

        function showDashboard() {
            showPage('dashboard');
            updateHeaderForUser();
            updateDashboard();
        }

        // Auth Functions
        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            // Simple validation
            if (!email || !password) {
                showNotification('Email dan password harus diisi', 'error');
                return;
            }

            // Check if user exists
            const users = JSON.parse(localStorage.getItem('cryptodax-users') || '[]');
            const user = users.find(u => u.email === email && u.password === password);

            if (user) {
                appState.currentUser = user;
                localStorage.setItem('cryptodax-user', JSON.stringify(user));
                loadUserData();
                showDashboard();
                showNotification('Login berhasil!', 'success');
            } else {
                showNotification('Email atau password salah', 'error');
            }
        }

        function handleRegister(e) {
            e.preventDefault();
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;

            // Validation
            if (!name || !email || !password || !confirmPassword) {
                showNotification('Semua field harus diisi', 'error');
                return;
            }

            if (password.length < 6) {
                showNotification('Password harus minimal 6 karakter', 'error');
                return;
            }

            if (password !== confirmPassword) {
                showNotification('Password dan konfirmasi password tidak cocok', 'error');
                return;
            }

            // Check if user already exists
            const users = JSON.parse(localStorage.getItem('cryptodax-users') || '[]');
            if (users.find(u => u.email === email)) {
                showNotification('Email sudah terdaftar', 'error');
                return;
            }

            // Create new user
            const newUser = {
                id: Date.now(),
                name,
                email,
                password,
                balance: 0,
                assets: {},
                transactions: [],
                verification: {
                    emailVerified: false,
                    identityVerified: false
                },
                bankAccounts: [],
                profit: 0,
                loss: 0
            };

            users.push(newUser);
            localStorage.setItem('cryptodax-users', JSON.stringify(users));

            appState.currentUser = newUser;
            localStorage.setItem('cryptodax-user', JSON.stringify(newUser));
            loadUserData();
            showDashboard();
            showNotification('Pendaftaran berhasil! Silakan verifikasi akun Anda untuk melakukan transaksi.', 'success');
        }

        function handleLogout() {
            appState.currentUser = null;
            localStorage.removeItem('cryptodax-user');
            showHomePage();
            showNotification('Logout berhasil', 'success');
        }

        // User Data Management
        function loadUserData() {
            if (!appState.currentUser) return;
            
            const userData = JSON.parse(localStorage.getItem(`cryptodax-userdata-${appState.currentUser.id}`) || '{}');
            appState.userData = {
                balance: userData.balance || 0,
                assets: userData.assets || {},
                transactions: userData.transactions || [],
                verification: userData.verification || {
                    emailVerified: false,
                    identityVerified: false
                },
                bankAccounts: userData.bankAccounts || [],
                profit: userData.profit || 0,
                loss: userData.loss || 0
            };
        }

        function saveUserData() {
            if (!appState.currentUser) return;
            localStorage.setItem(`cryptodax-userdata-${appState.currentUser.id}`, JSON.stringify(appState.userData));
        }

        // Verification Functions
        function handleEmailVerification(e) {
            e.preventDefault();
            const code = document.getElementById('emailCode').value;
            
            // Simulate email verification (in real app, this would check against a code sent to email)
            if (code.length === 6) {
                appState.userData.verification.emailVerified = true;
                saveUserData();
                showNotification('Email berhasil diverifikasi!', 'success');
                emailVerificationForm.reset();
            } else {
                showNotification('Kode verifikasi tidak valid. Pastikan kode terdiri dari 6 digit.', 'error');
            }
        }

        function handleIdentityVerification(e) {
            e.preventDefault();
            const ktpPhoto = document.getElementById('ktpPhoto').files[0];
            const selfiePhoto = document.getElementById('selfiePhoto').files[0];
            
            if (ktpPhoto && selfiePhoto) {
                // Simulate identity verification (in real app, this would upload to server)
                appState.userData.verification.identityVerified = true;
                saveUserData();
                showNotification('Verifikasi identitas berhasil! Proses verifikasi membutuhkan waktu 1-2 hari kerja.', 'success');
                identityVerificationForm.reset();
                verificationModal.classList.remove('active');
            } else {
                showNotification('Harap unggah kedua foto yang diperlukan.', 'error');
            }
        }

        // Wallet Functions
        function handleDeposit(e) {
            e.preventDefault();
            const amount = parseInt(document.getElementById('depositAmount').value);
            const selectedMethod = document.querySelector('.payment-method.selected');
            
            if (!selectedMethod) {
                showNotification('Pilih metode pembayaran terlebih dahulu', 'error');
                return;
            }
            
            const method = selectedMethod.getAttribute('data-method');
            const paymentInfo = paymentMethods[method];
            
            if (amount < 10000) {
                showNotification('Minimal deposit adalah Rp 10.000', 'error');
                return;
            }

            // Show payment instructions
            showPaymentInstructions('deposit', amount, method, paymentInfo);
        }

        function handleWithdraw(e) {
            e.preventDefault();
            const amount = parseInt(document.getElementById('withdrawAmount').value);
            const bank = document.getElementById('withdrawBank').value;
            const accountNumber = document.getElementById('withdrawAccountNumber').value;
            const accountName = document.getElementById('withdrawAccountName').value;

            if (amount < 50000) {
                showNotification('Minimal withdraw adalah Rp 50.000', 'error');
                return;
            }

            if (amount > 100000000) {
                showNotification('Maksimal withdraw adalah Rp 100.000.000', 'error');
                return;
            }

            if (amount > appState.userData.balance) {
                showNotification('Saldo tidak mencukupi', 'error');
                return;
            }

            if (!bank || !accountNumber || !accountName) {
                showNotification('Harap lengkapi semua informasi rekening tujuan', 'error');
                return;
            }

            // Add withdrawal fee
            const withdrawalFee = 6500;
            const totalDeduction = amount + withdrawalFee;
            
            if (totalDeduction > appState.userData.balance) {
                showNotification(`Saldo tidak mencukupi. Withdraw memerlukan biaya admin Rp ${withdrawalFee}. Total yang diperlukan: Rp ${formatCurrency(totalDeduction)}`, 'error');
                return;
            }

            // Show confirmation modal
            showWithdrawConfirmation(amount, bank, accountNumber, accountName, withdrawalFee);
        }

        function showWithdrawConfirmation(amount, bank, accountNumber, accountName, fee) {
            // Update confirmation modal with data
            confirmAmount.textContent = `Rp ${formatCurrency(amount)}`;
            confirmBank.textContent = document.getElementById('withdrawBank').options[document.getElementById('withdrawBank').selectedIndex].text;
            confirmAccountNumber.textContent = accountNumber;
            confirmAccountName.textContent = accountName;
            confirmTotal.textContent = `Rp ${formatCurrency(amount + fee)}`;
            
            // Show confirmation modal
            withdrawModal.classList.remove('active');
            showModal(withdrawConfirmModal);
        }

        function processWithdraw() {
            const amount = parseInt(document.getElementById('withdrawAmount').value);
            const bank = document.getElementById('withdrawBank').value;
            const accountNumber = document.getElementById('withdrawAccountNumber').value;
            const accountName = document.getElementById('withdrawAccountName').value;
            const withdrawalFee = 6500;
            const totalDeduction = amount + withdrawalFee;
            
            // Show loading state
            const originalText = confirmWithdrawBtn.innerHTML;
            confirmWithdrawBtn.innerHTML = '<div class="loading-spinner"></div> Memproses...';
            confirmWithdrawBtn.disabled = true;
            
            // Simulate API call delay
            setTimeout(() => {
                // Process withdrawal
                appState.userData.balance -= totalDeduction;
                appState.userData.transactions.push({
                    id: Date.now(),
                    type: 'withdraw',
                    amount: amount,
                    fee: withdrawalFee,
                    bank: bank,
                    accountNumber: accountNumber,
                    accountName: accountName,
                    date: new Date().toISOString(),
                    status: 'pending'
                });

                saveUserData();
                updateWalletDisplay();
                updateDashboard();
                withdrawConfirmModal.classList.remove('active');
                withdrawForm.reset();
                
                // Reset button
                confirmWithdrawBtn.innerHTML = originalText;
                confirmWithdrawBtn.disabled = false;
                
                showNotification(`Permintaan withdraw berhasil diajukan! Dana akan ditransfer dalam 1-3 hari kerja. Biaya admin: Rp ${formatCurrency(withdrawalFee)}`, 'success');
            }, 1500);
        }

        function updateWithdrawForm() {
            // Update available balance
            availableBalance.textContent = `Rp ${formatCurrency(appState.userData.balance)}`;
            
            // Reset form
            withdrawForm.reset();
            updateWithdrawSummary();
        }

        function updateWithdrawSummary() {
            const amount = parseInt(withdrawAmount.value) || 0;
            const fee = 6500;
            const total = amount + fee;
            
            summaryAmount.textContent = `Rp ${formatCurrency(amount)}`;
            summaryTotal.textContent = `Rp ${formatCurrency(total)}`;
            
            // Validate amount
            if (amount > 0) {
                if (amount < 50000) {
                    submitWithdrawBtn.disabled = true;
                    submitWithdrawBtn.title = "Minimum withdraw adalah Rp 50.000";
                } else if (amount > 100000000) {
                    submitWithdrawBtn.disabled = true;
                    submitWithdrawBtn.title = "Maksimum withdraw adalah Rp 100.000.000";
                } else if (total > appState.userData.balance) {
                    submitWithdrawBtn.disabled = true;
                    submitWithdrawBtn.title = "Saldo tidak mencukupi";
                } else {
                    submitWithdrawBtn.disabled = false;
                    submitWithdrawBtn.title = "";
                }
            } else {
                submitWithdrawBtn.disabled = true;
                submitWithdrawBtn.title = "Masukkan jumlah withdraw";
            }
        }

        function completeDeposit(amount, method) {
            const paymentInfo = paymentMethods[method];
            const netAmount = amount - paymentInfo.fee;
            
            appState.userData.balance += netAmount;
            appState.userData.transactions.push({
                id: Date.now(),
                type: 'deposit',
                amount: netAmount,
                fee: paymentInfo.fee,
                method: method,
                date: new Date().toISOString(),
                status: 'completed'
            });

            saveUserData();
            updateWalletDisplay();
            updateDashboard();
            paymentModal.classList.remove('active');
            depositModal.classList.remove('active');
            depositForm.reset();
            showNotification(`Deposit berhasil! Saldo Anda bertambah Rp ${formatCurrency(netAmount)}. Biaya transaksi: Rp ${formatCurrency(paymentInfo.fee)}`, 'success');
        }

        function showPaymentInstructions(type, amount, method, paymentInfo) {
            paymentModalTitle.textContent = `Instruksi ${type === 'deposit' ? 'Deposit' : 'Pembayaran'}`;
            
            let instructionsHTML = `
                <div class="payment-summary">
                    <div style="background-color: #f0f9ff; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="margin-bottom: 10px; color: var(--primary);">Ringkasan Transaksi</h4>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>Jumlah ${type === 'deposit' ? 'Deposit' : 'Pembayaran'}:</span>
                            <span>Rp ${formatCurrency(amount)}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>Biaya Transaksi:</span>
                            <span>Rp ${formatCurrency(paymentInfo.fee)}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-weight: 600;">
                            <span>Total:</span>
                            <span>Rp ${formatCurrency(type === 'deposit' ? amount : amount + paymentInfo.fee)}</span>
                        </div>
                    </div>
                    
                    <h4 style="margin-bottom: 15px;">Instruksi Pembayaran</h4>
                    <ol style="margin-left: 20px; margin-bottom: 20px;">
            `;
            
            paymentInfo.instructions.forEach(instruction => {
                instructionsHTML += `<li style="margin-bottom: 10px;">${instruction}</li>`;
            });
            
            instructionsHTML += `
                    </ol>
                    
                    <div style="background-color: #fef3c7; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="color: #d97706; margin-bottom: 10px;">Penting!</h4>
                        <p style="font-size: 0.9rem; margin-bottom: 0;">
                            Jangan tutup halaman ini sampai pembayaran selesai. Transaksi akan diproses otomatis setelah pembayaran berhasil.
                        </p>
                    </div>
            `;
            
            if (type === 'deposit') {
                instructionsHTML += `
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-success" id="simulatePayment" style="width: 100%; margin-bottom: 10px;">
                            Simulasikan Pembayaran Berhasil
                        </button>
                        <button class="btn btn-outline" id="cancelPayment" style="width: 100%;">
                            Batalkan Transaksi
                        </button>
                    </div>
                `;
            }
            
            paymentContent.innerHTML = instructionsHTML;
            
            // Add event listeners for simulation buttons
            if (type === 'deposit') {
                document.getElementById('simulatePayment').addEventListener('click', () => {
                    completeDeposit(amount, method);
                });
                
                document.getElementById('cancelPayment').addEventListener('click', () => {
                    paymentModal.classList.remove('active');
                });
            }
            
            showModal(paymentModal);
        }

        // Percentage Functions for Buy/Sell
        function setBuyAmountByPercentage(percentage) {
            const amount = (appState.userData.balance * percentage) / 100;
            document.getElementById('buyAmount').value = Math.floor(amount);
        }

        function setSellAmountByPercentage(percentage) {
            const selectedCrypto = document.getElementById('sellCryptoSelect').value;
            if (selectedCrypto && appState.userData.assets[selectedCrypto]) {
                const availableAmount = appState.userData.assets[selectedCrypto].amount;
                const amount = (availableAmount * percentage) / 100;
                document.getElementById('sellAmount').value = amount.toFixed(4);
            }
        }

        function updateAvailableBuyBalance() {
            if (appState.currentUser) {
                availableBuyBalance.textContent = `Rp ${formatCurrency(appState.userData.balance)}`;
            }
        }

        function updateAvailableSellAmount() {
            const selectedCrypto = document.getElementById('sellCryptoSelect').value;
            if (selectedCrypto && appState.userData.assets[selectedCrypto]) {
                const availableAmount = appState.userData.assets[selectedCrypto].amount;
                availableSellAmount.textContent = availableAmount.toFixed(4);
                sellCryptoUnit.textContent = selectedCrypto;
            } else {
                availableSellAmount.textContent = '0';
                sellCryptoUnit.textContent = '';
            }
        }

        // Trade Functions
        function handleBuyCrypto(e) {
            e.preventDefault();
            const crypto = document.getElementById('buyCryptoSelect').value;
            const amount = parseInt(document.getElementById('buyAmount').value);

            if (amount < 10000) {
                showNotification('Minimal pembelian adalah Rp 10.000', 'error');
                return;
            }

            if (amount > appState.userData.balance) {
                showNotification('Saldo tidak mencukupi', 'error');
                return;
            }

            const cryptoData = appState.cryptoData.find(c => c.symbol === crypto);
            const cryptoAmount = amount / cryptoData.price;

            // Update user data
            appState.userData.balance -= amount;
            
            if (!appState.userData.assets[crypto]) {
                appState.userData.assets[crypto] = { amount: 0, totalSpent: 0 };
            }
            
            appState.userData.assets[crypto].amount += cryptoAmount;
            appState.userData.assets[crypto].totalSpent += amount;

            appState.userData.transactions.push({
                id: Date.now(),
                type: 'buy',
                crypto,
                amount: cryptoAmount,
                price: cryptoData.price,
                total: amount,
                date: new Date().toISOString()
            });

            saveUserData();
            updateWalletDisplay();
            updateDashboard();
            buyCryptoModal.classList.remove('active');
            buyCryptoForm.reset();
            
            // Reset percentage buttons
            document.querySelectorAll('#buyCryptoModal .percentage-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            showNotification(`Pembelian ${crypto} berhasil!`, 'success');
        }

        function handleSellCrypto(e) {
            e.preventDefault();
            const crypto = document.getElementById('sellCryptoSelect').value;
            const amount = parseFloat(document.getElementById('sellAmount').value);

            if (!appState.userData.assets[crypto] || appState.userData.assets[crypto].amount < amount) {
                showNotification('Jumlah kripto tidak mencukupi', 'error');
                return;
            }

            const cryptoData = appState.cryptoData.find(c => c.symbol === crypto);
            const idrAmount = amount * cryptoData.price;
            const asset = appState.userData.assets[crypto];
            const averageBuyPrice = asset.totalSpent / asset.amount;
            const profitLoss = (cryptoData.price - averageBuyPrice) * amount;

            // Update profit/loss
            if (profitLoss > 0) {
                appState.userData.profit += profitLoss;
            } else {
                appState.userData.loss += Math.abs(profitLoss);
            }

            // Update user data
            appState.userData.balance += idrAmount;
            appState.userData.assets[crypto].amount -= amount;
            appState.userData.assets[crypto].totalSpent -= averageBuyPrice * amount;

            // Remove crypto from assets if amount is 0
            if (appState.userData.assets[crypto].amount === 0) {
                delete appState.userData.assets[crypto];
            }

            appState.userData.transactions.push({
                id: Date.now(),
                type: 'sell',
                crypto,
                amount,
                price: cryptoData.price,
                total: idrAmount,
                profitLoss: profitLoss,
                date: new Date().toISOString()
            });

            saveUserData();
            updateWalletDisplay();
            updateDashboard();
            sellCryptoModal.classList.remove('active');
            sellCryptoForm.reset();
            
            // Reset percentage buttons
            document.querySelectorAll('#sellCryptoModal .percentage-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            showNotification(`Penjualan ${crypto} berhasil! ${profitLoss > 0 ? 'Profit: Rp ' + formatCurrency(profitLoss) : 'Loss: Rp ' + formatCurrency(Math.abs(profitLoss))}`, 'success');
        }

        // Trade Functions (Updated to include percentage buttons)
        function populateCryptoSelect(selectElement, onlyOwned = false, preselected = null) {
            selectElement.innerHTML = '';
            
            let options = [];
            
            if (onlyOwned) {
                // Only show cryptos that the user owns
                options = Object.keys(appState.userData.assets).map(symbol => {
                    return appState.cryptoData.find(c => c.symbol === symbol);
                }).filter(Boolean);
            } else {
                // Show all cryptos
                options = [...appState.cryptoData];
            }
            
            options.forEach(crypto => {
                const option = document.createElement('option');
                option.value = crypto.symbol;
                option.textContent = `${crypto.symbol} - ${crypto.name}`;
                selectElement.appendChild(option);
            });
            
            // Preselect if specified
            if (preselected) {
                selectElement.value = preselected;
            }
            
            // Update available balance/amount based on the selection
            if (selectElement.id === 'buyCryptoSelect') {
                updateAvailableBuyBalance();
            } else if (selectElement.id === 'sellCryptoSelect') {
                updateAvailableSellAmount();
            }
        }

        // Crypto Data Management
        function updateCryptoDisplay() {
            updateCryptoGrid();
            updateCryptoTable();
            updateMarketTable();
        }

        function updateCryptoGrid() {
            cryptoGrid.innerHTML = '';
            
            appState.cryptoData.forEach((crypto, index) => {
                const card = document.createElement('div');
                card.className = 'crypto-card';
                card.style.animationDelay = `${index * 0.1}s`;
                
                const changeClass = crypto.change24h >= 0 ? 'positive' : 'negative';
                const changeIcon = crypto.change24h >= 0 ? '▲' : '▼';
                
                card.innerHTML = `
                    <div class="crypto-header">
                        <div class="crypto-icon">${crypto.icon}</div>
                        <div>
                            <div class="crypto-name">${crypto.name}</div>
                            <div class="crypto-symbol">${crypto.symbol}</div>
                        </div>
                    </div>
                    <div class="crypto-price">Rp ${formatCurrency(crypto.price)}</div>
                    <div class="crypto-change ${changeClass}">
                        ${changeIcon} ${Math.abs(crypto.change24h).toFixed(2)}%
                    </div>
                `;
                
                cryptoGrid.appendChild(card);
            });
        }

        function updateCryptoTable() {
            cryptoTable.innerHTML = '';
            
            appState.cryptoData.forEach(crypto => {
                const row = document.createElement('tr');
                
                const changeClass = crypto.change24h >= 0 ? 'positive' : 'negative';
                const changeIcon = crypto.change24h >= 0 ? '▲' : '▼';
                
                row.innerHTML = `
                    <td>
                        <div style="display: flex; align-items: center;">
                            <div class="crypto-icon" style="margin-right: 10px;">${crypto.icon}</div>
                            <div>
                                <div style="font-weight: 600;">${crypto.symbol}</div>
                                <div style="font-size: 0.8rem; color: var(--gray);">${crypto.name}</div>
                            </div>
                        </div>
                    </td>
                    <td>Rp ${formatCurrency(crypto.price)}</td>
                    <td class="${changeClass}">${changeIcon} ${Math.abs(crypto.change24h).toFixed(2)}%</td>
                    <td>Rp ${formatCurrency(crypto.volume)}</td>
                    <td><button class="btn btn-primary" data-symbol="${crypto.symbol}">Trade</button></td>
                `;
                
                cryptoTable.appendChild(row);
            });

            // Add event listeners to trade buttons
            document.querySelectorAll('#cryptoTable .btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (!appState.currentUser) {
                        showPage('login');
                        return;
                    }
                    
                    const symbol = btn.getAttribute('data-symbol');
                    populateCryptoSelect(buyCryptoSelect, false, symbol);
                    showModal(buyCryptoModal);
                });
            });
        }

        function updateMarketTable() {
            marketTable.innerHTML = '';
            
            // Add more crypto for market page
            const marketData = [...appState.cryptoData];
            marketData.push(
                { symbol: 'ADA', name: 'Cardano', price: 4500, change24h: 1.2, change7d: 3.5, volume: 15000000000, icon: 'A' },
                { symbol: 'DOT', name: 'Polkadot', price: 65000, change24h: -2.1, change7d: 1.8, volume: 9000000000, icon: 'D' },
                { symbol: 'LINK', name: 'Chainlink', price: 85000, change24h: 0.5, change7d: -1.2, volume: 5000000000, icon: 'L' },
                { symbol: 'LTC', name: 'Litecoin', price: 900000, change24h: -0.3, change7d: 2.4, volume: 35000000000, icon: 'Ł' },
                { symbol: 'BCH', name: 'Bitcoin Cash', price: 2800000, change24h: 1.8, change7d: 4.2, volume: 25000000000, icon: 'B' }
            );
            
            marketData.forEach(crypto => {
                const row = document.createElement('tr');
                
                const change24hClass = crypto.change24h >= 0 ? 'positive' : 'negative';
                const change24hIcon = crypto.change24h >= 0 ? '▲' : '▼';
                
                const change7d = crypto.change7d !== undefined ? crypto.change7d : (crypto.change24h + (Math.random() * 4 - 2));
                const change7dClass = change7d >= 0 ? 'positive' : 'negative';
                const change7dIcon = change7d >= 0 ? '▲' : '▼';
                
                row.innerHTML = `
                    <td>
                        <div style="display: flex; align-items: center;">
                            <div class="crypto-icon" style="margin-right: 10px;">${crypto.icon}</div>
                            <div>
                                <div style="font-weight: 600;">${crypto.symbol}</div>
                                <div style="font-size: 0.8rem; color: var(--gray);">${crypto.name}</div>
                            </div>
                        </div>
                    </td>
                    <td>Rp ${formatCurrency(crypto.price)}</td>
                    <td class="${change24hClass}">${change24hIcon} ${Math.abs(crypto.change24h).toFixed(2)}%</td>
                    <td class="${change7dClass}">${change7dIcon} ${Math.abs(change7d).toFixed(2)}%</td>
                    <td>Rp ${formatCurrency(crypto.volume)}</td>
                    <td><button class="btn btn-primary" data-symbol="${crypto.symbol}">Trade</button></td>
                `;
                
                marketTable.appendChild(row);
            });

            // Add event listeners to trade buttons
            document.querySelectorAll('#marketTable .btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (!appState.currentUser) {
                        showPage('login');
                        return;
                    }
                    
                    const symbol = btn.getAttribute('data-symbol');
                    populateCryptoSelect(buyCryptoSelect, false, symbol);
                    showModal(buyCryptoModal);
                });
            });
        }

        // Dashboard Functions
        function updateDashboard() {
            if (!appState.currentUser) return;
            
            // Update balance
            dashboardBalance.textContent = `Rp ${formatCurrency(appState.userData.balance)}`;
            
            // Calculate total assets value
            let totalAssetsValue = 0;
            let totalSpent = 0;
            
            Object.keys(appState.userData.assets).forEach(symbol => {
                const crypto = appState.cryptoData.find(c => c.symbol === symbol);
                if (crypto) {
                    totalAssetsValue += appState.userData.assets[symbol].amount * crypto.price;
                    totalSpent += appState.userData.assets[symbol].totalSpent;
                }
            });
            
            dashboardAssets.textContent = `Rp ${formatCurrency(totalAssetsValue)}`;
            
            // Update profit/loss
            dashboardProfit.textContent = `Rp ${formatCurrency(appState.userData.profit)}`;
            dashboardLoss.textContent = `Rp ${formatCurrency(appState.userData.loss)}`;
            
            // Update profile page
            totalProfit.textContent = `Rp ${formatCurrency(appState.userData.profit)}`;
            totalLoss.textContent = `Rp ${formatCurrency(appState.userData.loss)}`;
            
            // Update portfolio table
            updatePortfolioTable();
        }

        function updatePortfolioTable() {
            portfolioTable.innerHTML = '';
            
            Object.keys(appState.userData.assets).forEach(symbol => {
                const asset = appState.userData.assets[symbol];
                const crypto = appState.cryptoData.find(c => c.symbol === symbol);
                
                if (crypto) {
                    const currentValue = asset.amount * crypto.price;
                    const profitLoss = currentValue - asset.totalSpent;
                    const profitLossPercent = (profitLoss / asset.totalSpent) * 100;
                    const profitLossClass = profitLoss >= 0 ? 'positive' : 'negative';
                    const profitLossIcon = profitLoss >= 0 ? '▲' : '▼';
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <div style="display: flex; align-items: center;">
                                <div class="crypto-icon" style="margin-right: 10px;">${crypto.icon}</div>
                                <div>
                                    <div style="font-weight: 600;">${crypto.symbol}</div>
                                    <div style="font-size: 0.8rem; color: var(--gray);">${crypto.name}</div>
                                </div>
                            </div>
                        </td>
                        <td>${asset.amount.toFixed(4)}</td>
                        <td>Rp ${formatCurrency(asset.totalSpent / asset.amount)}</td>
                        <td>Rp ${formatCurrency(currentValue)}</td>
                        <td class="${profitLossClass}">
                            ${profitLossIcon} Rp ${formatCurrency(Math.abs(profitLoss))} (${Math.abs(profitLossPercent).toFixed(2)}%)
                        </td>
                    `;
                    
                    portfolioTable.appendChild(row);
                }
            });
            
            // Show message if no assets
            if (portfolioTable.children.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="5" style="text-align: center; padding: 30px; color: var(--gray);">
                        Anda belum memiliki aset kripto. Mulai berinvestasi dengan menekan tombol "Beli Kripto".
                    </td>
                `;
                portfolioTable.appendChild(row);
            }
        }

        // Wallet Display
        function updateWalletDisplay() {
            if (!appState.currentUser) return;
            
            // Update balance
            idrBalance.textContent = `Rp ${formatCurrency(appState.userData.balance)}`;
            
            // Update assets table
            updateWalletAssets();
            
            // Update transaction history
            updateTransactionHistory();
        }

        function updateWalletAssets() {
            walletAssets.innerHTML = '';
            
            Object.keys(appState.userData.assets).forEach(symbol => {
                const asset = appState.userData.assets[symbol];
                const crypto = appState.cryptoData.find(c => c.symbol === symbol);
                
                if (crypto) {
                    const currentValue = asset.amount * crypto.price;
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <div style="display: flex; align-items: center;">
                                <div class="crypto-icon" style="margin-right: 10px;">${crypto.icon}</div>
                                <div>
                                    <div style="font-weight: 600;">${crypto.symbol}</div>
                                    <div style="font-size: 0.8rem; color: var(--gray);">${crypto.name}</div>
                                </div>
                            </div>
                        </td>
                        <td>${asset.amount.toFixed(4)}</td>
                        <td>Rp ${formatCurrency(currentValue)}</td>
                        <td>
                            <button class="btn btn-primary" data-symbol="${crypto.symbol}">Trade</button>
                        </td>
                    `;
                    
                    walletAssets.appendChild(row);
                }
            });
            
            // Show message if no assets
            if (walletAssets.children.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="4" style="text-align: center; padding: 30px; color: var(--gray);">
                        Anda belum memiliki aset kripto.
                    </td>
                `;
                walletAssets.appendChild(row);
            }
            
            // Add event listeners to trade buttons
            document.querySelectorAll('#walletAssets .btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const symbol = btn.getAttribute('data-symbol');
                    populateCryptoSelect(sellCryptoSelect, true, symbol);
                    showModal(sellCryptoModal);
                });
            });
        }

        function updateTransactionHistory() {
            transactionHistory.innerHTML = '';
            
            // Show latest 10 transactions
            const recentTransactions = appState.userData.transactions
                .slice(-10)
                .reverse();
            
            recentTransactions.forEach(transaction => {
                const row = document.createElement('tr');
                const date = new Date(transaction.date).toLocaleDateString('id-ID');
                
                let typeText = '';
                let amountText = '';
                let statusClass = '';
                
                switch (transaction.type) {
                    case 'deposit':
                        typeText = 'Deposit';
                        amountText = `+ Rp ${formatCurrency(transaction.amount)}`;
                        statusClass = 'positive';
                        break;
                    case 'withdraw':
                        typeText = 'Withdraw';
                        amountText = `- Rp ${formatCurrency(transaction.amount)}`;
                        statusClass = transaction.status === 'pending' ? 'warning' : 'positive';
                        break;
                    case 'buy':
                        typeText = `Beli ${transaction.crypto}`;
                        amountText = `- Rp ${formatCurrency(transaction.total)}`;
                        statusClass = 'negative';
                        break;
                    case 'sell':
                        typeText = `Jual ${transaction.crypto}`;
                        amountText = `+ Rp ${formatCurrency(transaction.total)}`;
                        statusClass = 'positive';
                        break;
                }
                
                row.innerHTML = `
                    <td>${date}</td>
                    <td>${typeText}</td>
                    <td class="${statusClass}">${amountText}</td>
                    <td>${transaction.status === 'pending' ? 'Menunggu' : 'Selesai'}</td>
                `;
                
                transactionHistory.appendChild(row);
            });
            
            // Show message if no transactions
            if (transactionHistory.children.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="4" style="text-align: center; padding: 30px; color: var(--gray);">
                        Belum ada transaksi.
                    </td>
                `;
                transactionHistory.appendChild(row);
            }
        }

        // UI Helper Functions
        function updateHeaderForUser() {
            loginBtn.style.display = 'none';
            registerBtn.style.display = 'none';
        }

        function updateHeaderForGuest() {
            loginBtn.style.display = 'inline-block';
            registerBtn.style.display = 'inline-block';
        }

        function showModal(modal) {
            modal.classList.add('active');
        }

        function toggleTheme() {
            appState.theme = appState.theme === 'light' ? 'dark' : 'light';
            document.body.setAttribute('data-theme', appState.theme);
            localStorage.setItem('cryptodax-theme', appState.theme);
            updateThemeToggleIcon();
        }

        function updateThemeToggleIcon() {
            const icon = themeToggle.querySelector('i');
            if (appState.theme === 'light') {
                icon.className = 'fas fa-moon';
            } else {
                icon.className = 'fas fa-sun';
            }
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('id-ID').format(amount);
        }

        function showNotification(message, type) {
            // Remove existing notifications
            document.querySelectorAll('.notification').forEach(notif => notif.remove());
            
            // Create new notification
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div style="display: flex; align-items: center;">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'exclamation-triangle'}" style="margin-right: 10px;"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Remove notification after animation
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }

        // Price Updates (Improved)
        function startPriceUpdates() {
            setInterval(() => {
                // Update prices with random changes
                appState.cryptoData.forEach(crypto => {
                    const change = (Math.random() * 4 - 2); // -2% to +2%
                    crypto.price = Math.max(1, crypto.price * (1 + change / 100));
                    crypto.change24h = change;
                    crypto.volume = crypto.volume * (1 + (Math.random() * 10 - 5) / 100);
                    
                    // Update price history for chart
                    if (appState.priceHistory[crypto.symbol]) {
                        // Remove oldest data point
                        if (appState.priceHistory[crypto.symbol].length >= 24) {
                            appState.priceHistory[crypto.symbol].shift();
                        }
                        
                        // Add new data point
                        const now = new Date();
                        const timeString = `${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`;
                        appState.priceHistory[crypto.symbol].push({
                            time: timeString,
                            price: crypto.price
                        });
                    }
                });
                
                updateCryptoDisplay();
                
                // Update dashboard if user is logged in
                if (appState.currentUser) {
                    updateDashboard();
                    updateWalletDisplay();
                }
                
                // Update chart if it exists
                if (window.priceChart) {
                    updateChart();
                }
            }, 5000); // Update every 5 seconds
        }

        // Chart Initialization (Improved)
        let priceChart;

        function initChart() {
            const ctx = document.getElementById('priceChart').getContext('2d');
            
            // Use BTC data for the chart by default
            const btcHistory = appState.priceHistory['BTC'] || [];
            const labels = btcHistory.map(item => item.time);
            const data = btcHistory.map(item => item.price);
            
            priceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Harga Bitcoin (IDR)',
                        data: data,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    return `Rp ${formatCurrency(context.parsed.y)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return 'Rp ' + formatCurrency(value);
                                }
                            }
                        }
                    }
                }
            });
        }

        function updateChart() {
            if (!priceChart) return;
            
            // Use BTC data for the chart by default
            const btcHistory = appState.priceHistory['BTC'] || [];
            const labels = btcHistory.map(item => item.time);
            const data = btcHistory.map(item => item.price);
            
            priceChart.data.labels = labels;
            priceChart.data.datasets[0].data = data;
            priceChart.update('none');
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
